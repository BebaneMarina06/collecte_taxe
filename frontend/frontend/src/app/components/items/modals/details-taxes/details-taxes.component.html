<div class="w-full max-w-full modal-content-wrapper">
  <!--  HEAD -->
  <div class="flex justify-between items-center">
    <div>
      @if (contribuable) {
        <p class="text-main font-bold text-2xl">Taxes du contribuable</p>
        <p class="text-sm text-gray-600">{{ contribuable.nom }} {{ contribuable.prenom || '' }}</p>
      } @else if (taxe) {
        <p class="text-main font-bold text-2xl">Détails de la taxe</p>
        <p class="text-sm text-gray-600">{{ taxe.nom }}</p>
      }
    </div>
    @if (contribuable) {
      <div class="flex gap-2">
        <button
          (click)="onactiveModalAssignTaxe(true)"
          class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
          <svg class="w-4 h-4 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
          </svg>
          Attribuer une taxe
        </button>
      </div>
    }
  </div>

  <!-- CONTENT TAXE INDIVIDUELLE -->
  @if (taxe) {
    <app-contener-gray>
      <ul class="flex flex-col gap-3">
        <li class="flex justify-between text-[14px]">
          <span>Nom</span>
          <span class="font-medium">{{ taxe.nom }}</span>
        </li>
        <li class="flex justify-between text-[14px]">
          <span>Code</span>
          <span class="font-medium">{{ taxe.code }}</span>
        </li>
        <li class="flex justify-between text-[14px]">
          <span>Type</span>
          <span class="font-medium">{{ taxe.type_taxe?.nom || 'N/A' }}</span>
        </li>
        <li class="flex justify-between text-[14px]">
          <span>Montant</span>
          <span class="font-medium">
            {{ taxe.montant_variable ? 'Variable' : formatNumber(taxe.montant) + ' FCFA' }}
          </span>
        </li>
        <li class="flex justify-between text-[14px]">
          <span>Périodicité</span>
          <span class="font-medium">{{ getPeriodiciteLabel(taxe.periodicite) }}</span>
        </li>
        <li class="flex justify-between text-[14px]">
          <span>Commission</span>
          <span class="font-medium">{{ taxe.commission_pourcentage }}%</span>
        </li>
        <li class="flex justify-between text-[14px]">
          <span>Date d'ajout</span>
          <span class="font-medium">{{ formatDate(taxe.created_at) }}</span>
        </li>
        <li class="flex justify-between text-[14px]">
          <span>Statut</span>
          <span class="font-medium" [class.text-green-600]="taxe.actif" [class.text-red-600]="!taxe.actif">
            {{ taxe.actif ? 'Actif' : 'Inactif' }}
          </span>
        </li>
      </ul>
    </app-contener-gray>

    <p class="mb-2 pb-2 w-full font-medium">Description</p>
    <app-contener-gray>
      <p class="text-[14px] text-gray-700">
        {{ taxe.description || 'Aucune description disponible' }}
      </p>
    </app-contener-gray>
  }

  <!-- Loading -->
  @if (loading) {
    <div class="text-center py-8">
      <svg class="animate-spin h-8 w-8 text-main mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
      </svg>
      <p class="mt-2 text-gray-600">Chargement des taxes...</p>
    </div>
  }

  <!-- Error -->
  @if (error) {
    <div class="text-center py-8">
      <div class="text-red-600 mb-2">
        <svg class="w-8 h-8 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
        </svg>
      </div>
      <p class="text-red-600">{{ error }}</p>
    </div>
  }

  <!-- CONTENT TAXATIONS CONTRIBUABLE -->
  @if (!taxe && taxations.length > 0) {
    <div class="space-y-4">
      @for (taxation of taxations; track taxation.id) {
        <app-contener-gray>
          <div class="flex justify-between items-start mb-3">
            <div class="flex-1">
              <h3 class="font-semibold text-lg text-gray-900">{{ taxation.taxe_nom }}</h3>
              <p class="text-sm text-gray-600">{{ taxation.periode_debut }} - {{ taxation.periode_fin || 'En cours' }}</p>
            </div>
            <div class="flex flex-col items-end gap-1">
              <span class="px-2 py-1 rounded-full text-xs font-medium"
                    [class.bg-green-100]="taxation.statut === 'paye'"
                    [class.bg-yellow-100]="taxation.statut === 'partiel'"
                    [class.bg-red-100]="taxation.statut === 'impaye'">
                {{ taxation.statut }}
              </span>
              @if (taxation.est_en_retard) {
                <span class="px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-700">
                  En retard
                </span>
              }
            </div>
          </div>

          <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
            <div>
              <p class="text-gray-500">Montant attendu</p>
              <p class="font-medium">{{ formatNumber(taxation.montant_attendu) }} FCFA</p>
            </div>
            <div>
              <p class="text-gray-500">Montant payé</p>
              <p class="font-medium">{{ formatNumber(taxation.montant_paye) }} FCFA</p>
            </div>
            <div>
              <p class="text-gray-500">Restant dû</p>
              <p class="font-medium" [class.text-red-600]="taxation.montant_restant > 0">
                {{ formatNumber(taxation.montant_restant) }} FCFA
              </p>
            </div>
            <div>
              <p class="text-gray-500">Échéance</p>
              <p class="font-medium">{{ taxation.date_echeance ? formatDate(taxation.date_echeance) : 'N/A' }}</p>
            </div>
          </div>
        </app-contener-gray>
      }
    </div>
  } @else if (!taxe) {
    <div class="text-center py-12">
      <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
      </svg>
      <p class="text-gray-500 text-lg font-medium">Aucune taxe attribuée</p>
      <p class="text-gray-400 text-sm mt-1">Ce contribuable n'a pas encore de taxes assignées</p>
      <button
        (click)="onactiveModalAssignTaxe(true)"
        class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors">
        Attribuer une première taxe
      </button>
    </div>
  }

  <!-- Modal d'attribution de taxe -->
  @if (activeModalAssignTaxe()) {
    <app-modal [(active)]="activeModalAssignTaxe">
      <app-assign-taxes-contribuable
        [contribuable]="contribuable!"
        (taxesAssigned)="onTaxesAssigned()"
        (closeModal)="onactiveModalAssignTaxe(false)">
      </app-assign-taxes-contribuable>
    </app-modal>
  }

  <div class="grid grid-cols-2 gap-3 pt-20 pb-5">
    <button class="flex justify-center items-center gap-3 border-main border-2 font-medium text-main py-2 rounded-lg">
      <!-- <svg class="size-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path fill="currentColor"
          d="M12 6.25a.75.75 0 0 1 .75.75v5.19l1.72-1.72a.75.75 0 1 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 1 1 1.06-1.06l1.72 1.72V7a.75.75 0 0 1 .75-.75M7.25 17a.75.75 0 0 1 .75-.75h8a.75.75 0 0 1 0 1.5H8a.75.75 0 0 1-.75-.75" />
        <path fill="currentColor" fill-rule="evenodd"
          d="M11.943 1.25c-2.309 0-4.118 0-5.53.19c-1.444.194-2.584.6-3.479 1.494c-.895.895-1.3 2.035-1.494 3.48c-.19 1.411-.19 3.22-.19 5.529v.114c0 2.309 0 4.118.19 5.53c.194 1.444.6 2.584 1.494 3.479c.895.895 2.035 1.3 3.48 1.494c1.411.19 3.22.19 5.529.19h.114c2.309 0 4.118 0 5.53-.19c1.444-.194 2.584-.6 3.479-1.494c.895-.895 1.3-2.035 1.494-3.48c.19-1.411.19-3.22.19-5.529v-.114c0-2.309 0-4.118-.19-5.53c-.194-1.444-.6-2.584-1.494-3.479c-.895-.895-2.035-1.3-3.48-1.494c-1.411-.19-3.22-.19-5.529-.19zM3.995 3.995c.57-.57 1.34-.897 2.619-1.069c1.3-.174 3.008-.176 5.386-.176s4.086.002 5.386.176c1.279.172 2.05.5 2.62 1.069c.569.57.896 1.34 1.068 2.619c.174 1.3.176 3.008.176 5.386s-.002 4.086-.176 5.386c-.172 1.279-.5 2.05-1.069 2.62c-.57.569-1.34.896-2.619 1.068c-1.3.174-3.008.176-5.386.176s-4.086-.002-5.386-.176c-1.279-.172-2.05-.5-2.62-1.069c-.569-.57-.896-1.34-1.068-2.619c-.174-1.3-.176-3.008-.176-5.386s.002-4.086.176-5.386c.172-1.279.5-2.05 1.069-2.62"
          clip-rule="evenodd" />
      </svg> -->
      <span>Annuler</span>
    </button>
    @if (contribuable) {
      <button   (click)="onactiveModalAssignTaxe(true)"  class="flex justify-center items-center gap-3 bg-main text-white py-2 rounded-lg">
      <!-- <svg class="size-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <g fill="none">
          <path stroke="currentColor" stroke-width="1.5"
            d="M6 17.983c-1.553-.047-2.48-.22-3.121-.862C2 16.243 2 14.828 2 12s0-4.243.879-5.121C3.757 6 5.172 6 8 6h8c2.828 0 4.243 0 5.121.879C22 7.757 22 9.172 22 12s0 4.243-.879 5.121c-.641.642-1.567.815-3.121.862" />
          <path stroke="currentColor" stroke-linecap="round" stroke-width="1.5" d="M9 10H6m13 4H5" />
          <path fill="currentColor"
            d="m17.121 2.879l-.53.53zm-10.242 0l.53.53zm0 18.242l.53-.53zM18.75 14a.75.75 0 0 0-1.5 0zm-12 0a.75.75 0 0 0-1.5 0zm10.5 2c0 1.435-.002 2.436-.103 3.192c-.099.734-.28 1.122-.556 1.399l1.06 1.06c.603-.601.861-1.36.983-2.26c.118-.878.116-1.998.116-3.391zM12 22.75c1.393 0 2.513.002 3.392-.116c.9-.122 1.658-.38 2.26-.982L16.59 20.59c-.277.277-.665.457-1.4.556c-.755.101-1.756.103-3.191.103zm0-20c1.435 0 2.437.002 3.192.103c.734.099 1.122.28 1.399.556l1.06-1.06c-.601-.603-1.36-.861-2.26-.982c-.878-.119-1.998-.117-3.391-.117zm0-1.5c-1.393 0-2.513-.002-3.392.117c-.9.12-1.658.38-2.26.981L7.41 3.41c.277-.277.665-.457 1.4-.556c.754-.101 1.756-.103 3.191-.103zM5.25 16c0 1.393-.002 2.513.117 3.392c.12.9.38 1.658.981 2.26L7.41 20.59c-.277-.277-.457-.665-.556-1.4c-.101-.755-.103-1.756-.103-3.191zM12 21.25c-1.435 0-2.437-.002-3.192-.103c-.734-.099-1.122-.28-1.399-.556l-1.06 1.06c.601.603 1.36.861 2.26.983c.878.118 1.998.116 3.391.116zm6.732-15.273c-.046-1.542-.208-2.757-1.08-3.629L16.59 3.41c.41.41.595 1.049.642 2.614zm-11.965.046c.047-1.565.231-2.203.642-2.614l-1.06-1.06c-.873.871-1.035 2.086-1.081 3.628zM18.75 16v-2h-1.5v2zm-12 0v-2h-1.5v2z" />
          <circle cx="17" cy="10" r="1" fill="currentColor" />
          <path stroke="currentColor" stroke-linecap="round" stroke-width="1.5" d="M15 16.5H9m4 2.5H9" />
        </g>
      </svg> -->
      <svg class="size-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
      </svg>
      <span>Attribuer une taxe</span>
    </button>
    }
  </div>
  <!--  END BODY -->
</div>

@if (collecte) {
<div class="w-full max-w-full modal-content-wrapper">
<!--  HEAD -->
  <div class="flex justify-between items-center">
    <div>
      <p class="text-main font-bold text-2xl">+{{ parseMount(collecte.montant.toString(), ',') }} FCFA</p>
      <p>De {{ collecte.contribuable?.nom || 'N/A' }} {{ collecte.contribuable?.prenom || '' }}</p>
    </div>
    <div class="size-[70px] rounded-full bg-main overflow-hidden flex items-center justify-center">
      @if (collecte.type_paiement === 'mobile_money') {
        <img src="{{paiementLogo[0]}}" alt="Mobile Money" class="size-12 rounded-full object-contain">
      } @else if (collecte.type_paiement === 'carte') {
        <img src="{{paiementLogo[1]}}" alt="Carte" class="size-12 rounded-full object-contain">
      } @else {
        <span class="text-white text-2xl">üí∞</span>
      }
    </div>
  </div>
<!--  END HEAD -->
<!--  BODY -->
<!--  CONTENT 1 -->
  <app-contener-gray>
    <p class="mb-2 border-b-2 pb-2 w-full font-medium">D√©tails transaction</p>
    <ul class="flex flex-col gap-3">
      <li class="flex justify-between text-[14px]">
        <span>Collecteur</span>
        <span class="font-medium">{{ collecte.collecteur?.nom || 'N/A' }} {{ collecte.collecteur?.prenom || '' }}</span>
      </li>
      <li class="flex justify-between text-[14px]">
        <span>Moyen de paiement</span>
        <span class="font-medium">{{ getMoyenPaiementLabel(collecte.type_paiement) }}</span>
      </li>
      <li class="flex justify-between text-[14px]">
        <span>T√©l√©phone contribuable</span>
        <span class="font-medium">{{ collecte.contribuable?.telephone || 'N/A' }}</span>
      </li>
      <li class="flex justify-between text-[14px]">
        <span>Date & heure</span>
        <span class="font-medium">{{ formatDateTime(collecte.date_collecte) }}</span>
      </li>
      <li class="flex justify-between text-[14px]">
        <span>Statut</span>
        <span class="font-medium" [class]="getStatutColor(collecte.statut)">{{ getStatutLabel(collecte.statut) }}</span>
      </li>
      <li class="flex justify-between text-[14px]">
        <span>Montant collect√©</span>
        <span class="font-medium">{{ parseMount(collecte.montant.toString(), ',') }} FCFA</span>
      </li>
      <li class="flex justify-between text-[14px]">
        <span>Commission</span>
        <span class="font-medium">{{ parseMount(collecte.commission.toString(), ',') }} FCFA</span>
      </li>
      <li class="flex justify-between text-[14px]">
        <span>Montant net</span>
        <span class="font-medium">{{ parseMount((collecte.montant - collecte.commission).toString(), ',') }} FCFA</span>
      </li>
      @if (collecte.annule && collecte.raison_annulation) {
        <li class="flex justify-between text-[14px]">
          <span>Raison annulation</span>
          <span class="font-medium text-red-600">{{ collecte.raison_annulation }}</span>
        </li>
      }
    </ul>
  </app-contener-gray>
<!--  END CONTENT 1-->
  <!--  CONTENT 2 -->
  <app-contener-gray>
    <p class="mb-2 border-b-2 pb-2 w-full font-medium">D√©tails de la taxe</p>
    <ul class="flex flex-col gap-3">
      <li class="flex justify-between text-[14px]">
        <span>Nom</span>
        <span class="font-medium">{{ collecte.taxe?.nom || 'N/A' }}</span>
      </li>
      <li class="flex justify-between text-[14px]">
        <span>Code</span>
        <span class="font-medium">{{ collecte.taxe?.code || 'N/A' }}</span>
      </li>
      <li class="flex justify-between text-[14px]">
        <span>Montant</span>
        <span class="font-medium">{{ parseMount(collecte.montant.toString(), ',') }} FCFA</span>
      </li>
      @if (collecte.taxe?.description) {
        <li class="flex justify-between text-[14px]">
          <span>Description</span>
          <span class="font-medium text-right max-w-[200px]">{{ collecte.taxe?.description }}</span>
        </li>
      }
    </ul>
  </app-contener-gray>
  <!--  END CONTENT 2 -->
  <!--  CONTENT 3 -->
  <app-contener-gray>
    <p class="mb-2 pb-2 w-full font-medium">Informations compl√©mentaires</p>
    <ul class="flex flex-col gap-3">
      <li class="flex justify-between text-[14px]">
        <span>R√©f√©rence</span>
        <div class="flex items-center gap-2">
          <span class="font-medium font-mono">{{ collecte.reference }}</span>
          <button class="font-medium" (click)="navigator.clipboard.writeText(collecte.reference)">
            <svg class="size-5 text-main" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
              <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" color="currentColor">
                <path d="M9 15c0-2.828 0-4.243.879-5.121C10.757 9 12.172 9 15 9h1c2.828 0 4.243 0 5.121.879C22 10.757 22 12.172 22 15v1c0 2.828 0 4.243-.879 5.121C20.243 22 18.828 22 16 22h-1c-2.828 0-4.243 0-5.121-.879C9 20.243 9 18.828 9 16z"/>
                <path d="M17 9c-.003-2.957-.047-4.489-.908-5.538a4 4 0 0 0-.554-.554C14.43 2 12.788 2 9.5 2c-3.287 0-4.931 0-6.038.908a4 4 0 0 0-.554.554C2 4.57 2 6.212 2 9.5c0 3.287 0 4.931.908 6.038a4 4 0 0 0 .554.554c1.05.86 2.58.906 5.538.908"/>
              </g>
            </svg>
          </button>
        </div>
      </li>
      <li class="flex justify-between text-[14px]">
        <span>SMS envoy√©</span>
        <span class="font-medium">{{ collecte.sms_envoye ? 'Oui' : 'Non' }}</span>
      </li>
      <li class="flex justify-between text-[14px]">
        <span>Ticket imprim√©</span>
        <span class="font-medium">{{ collecte.ticket_imprime ? 'Oui' : 'Non' }}</span>
      </li>
      @if (collecte.date_cloture) {
        <li class="flex justify-between text-[14px]">
          <span>Date de cl√¥ture</span>
          <span class="font-medium">{{ formatDateTime(collecte.date_cloture) }}</span>
        </li>
      }
    </ul>
  </app-contener-gray>
  <!--  END CONTENT 3 -->
  <!--  CONTENT 4 - QR Code -->
  <app-contener-gray>
    <p class="mb-2 pb-2 w-full font-medium">Code QR de validation</p>
    <div class="flex flex-col items-center gap-4 py-4">
      @if (isLoadingQR) {
        <div class="flex items-center justify-center w-64 h-64 bg-gray-100 rounded-lg">
          <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-main"></div>
        </div>
      } @else if (qrCodeDataUrl) {
        <div class="flex flex-col items-center gap-3">
          <div class="relative inline-block">
            <img [src]="qrCodeDataUrl" alt="QR Code de validation" class="w-64 h-64 border-4 rounded-lg shadow-lg bg-white p-2" [class.border-green-500]="isPaymentValid()" [class.border-red-500]="!isPaymentValid()">
            @if (isPaymentValid()) {
              <div class="absolute -top-3 -right-3 bg-green-500 text-white rounded-full p-2 shadow-lg">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"></path>
                </svg>
              </div>
            } @else {
              <div class="absolute -top-3 -right-3 bg-red-500 text-white rounded-full p-2 shadow-lg">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </div>
            }
          </div>
          <div class="text-center">
            <p class="text-base font-bold" [class.text-green-600]="isPaymentValid()" [class.text-red-600]="!isPaymentValid()">
              @if (isPaymentValid()) {
                ‚úì Paiement valid√©
              } @else {
                ‚úó Paiement non valid√©
              }
            </p>
            <p class="text-xs text-gray-500 mt-2">Scannez ce code QR pour v√©rifier<br/>la validit√© de la transaction</p>
            <p class="text-xs text-gray-400 mt-1 font-mono">{{ collecte.reference }}</p>
            <button 
              (click)="copyQRData()"
              class="mt-3 text-xs text-main hover:text-main/80 underline flex items-center gap-1 mx-auto">
              <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" color="currentColor">
                  <path d="M9 15c0-2.828 0-4.243.879-5.121C10.757 9 12.172 9 15 9h1c2.828 0 4.243 0 5.121.879C22 10.757 22 12.172 22 15v1c0 2.828 0 4.243-.879 5.121C20.243 22 18.828 22 16 22h-1c-2.828 0-4.243 0-5.121-.879C9 20.243 9 18.828 9 16z"/>
                  <path d="M17 9c-.003-2.957-.047-4.489-.908-5.538a4 4 0 0 0-.554-.554C14.43 2 12.788 2 9.5 2c-3.287 0-4.931 0-6.038.908a4 4 0 0 0-.554.554C2 4.57 2 6.212 2 9.5c0 3.287 0 4.931.908 6.038a4 4 0 0 0 .554.554c1.05.86 2.58.906 5.538.908"/>
                </g>
              </svg>
              Copier les donn√©es
            </button>
          </div>
        </div>
      } @else {
        <div class="text-center text-gray-500 py-8">
          <p>G√©n√©ration du QR code...</p>
        </div>
      }
    </div>
  </app-contener-gray>
  <!--  END CONTENT 4 -->
  <div class="grid grid-cols-2 gap-3 pt-5 pb-5">
    <button (click)="downloadReceiptPDF()" class="flex justify-center items-center gap-3 border-main border-2 font-medium text-main py-2 rounded-lg hover:bg-main hover:text-white transition-colors">
      <svg class="size-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <path fill="currentColor" d="M12 6.25a.75.75 0 0 1 .75.75v5.19l1.72-1.72a.75.75 0 1 1 1.06 1.06l-3 3a.75.75 0 0 1-1.06 0l-3-3a.75.75 0 1 1 1.06-1.06l1.72 1.72V7a.75.75 0 0 1 .75-.75M7.25 17a.75.75 0 0 1 .75-.75h8a.75.75 0 0 1 0 1.5H8a.75.75 0 0 1-.75-.75"/>
        <path fill="currentColor" fill-rule="evenodd" d="M11.943 1.25c-2.309 0-4.118 0-5.53.19c-1.444.194-2.584.6-3.479 1.494c-.895.895-1.3 2.035-1.494 3.48c-.19 1.411-.19 3.22-.19 5.529v.114c0 2.309 0 4.118.19 5.53c.194 1.444.6 2.584 1.494 3.479c.895.895 2.035 1.3 3.48 1.494c1.411.19 3.22.19 5.529.19h.114c2.309 0 4.118 0 5.53-.19c1.444-.194 2.584-.6 3.479-1.494c.895-.895 1.3-2.035 1.494-3.48c.19-1.411.19-3.22.19-5.529v-.114c0-2.309 0-4.118-.19-5.53c-.194-1.444-.6-2.584-1.494-3.479c-.895-.895-2.035-1.3-3.48-1.494c-1.411-.19-3.22-.19-5.529-.19zM3.995 3.995c.57-.57 1.34-.897 2.619-1.069c1.3-.174 3.008-.176 5.386-.176s4.086.002 5.386.176c1.279.172 2.05.5 2.62 1.069c.569.57.896 1.34 1.068 2.619c.174 1.3.176 3.008.176 5.386s-.002 4.086-.176 5.386c-.172 1.279-.5 2.05-1.069 2.62c-.57.569-1.34.896-2.619 1.068c-1.3.174-3.008.176-5.386.176s-4.086-.002-5.386-.176c-1.279-.172-2.05-.5-2.62-1.069c-.569-.57-.896-1.34-1.068-2.619c-.174-1.3-.176-3.008-.176-5.386s.002-4.086.176-5.386c.172-1.279.5-2.05 1.069-2.62" clip-rule="evenodd"/>
      </svg>
      <span>T√©l√©charger le re√ßu</span>
    </button>
    <button (click)="printReceipt()" class="flex justify-center items-center gap-3 bg-main text-white py-2 rounded-lg hover:bg-main/90 transition-colors">
      <svg class="size-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
        <g fill="none"><path stroke="currentColor" stroke-width="1.5" d="M6 17.983c-1.553-.047-2.48-.22-3.121-.862C2 16.243 2 14.828 2 12s0-4.243.879-5.121C3.757 6 5.172 6 8 6h8c2.828 0 4.243 0 5.121.879C22 7.757 22 9.172 22 12s0 4.243-.879 5.121c-.641.642-1.567.815-3.121.862"/>
          <path stroke="currentColor" stroke-linecap="round" stroke-width="1.5" d="M9 10H6m13 4H5"/>
          <path fill="currentColor" d="m17.121 2.879l-.53.53zm-10.242 0l.53.53zm0 18.242l.53-.53zM18.75 14a.75.75 0 0 0-1.5 0zm-12 0a.75.75 0 0 0-1.5 0zm10.5 2c0 1.435-.002 2.436-.103 3.192c-.099.734-.28 1.122-.556 1.399l1.06 1.06c.603-.601.861-1.36.983-2.26c.118-.878.116-1.998.116-3.391zM12 22.75c1.393 0 2.513.002 3.392-.116c.9-.122 1.658-.38 2.26-.982L16.59 20.59c-.277.277-.665.457-1.4.556c-.755.101-1.756.103-3.191.103zm0-20c1.435 0 2.437.002 3.192.103c.734.099 1.122.28 1.399.556l1.06-1.06c-.601-.603-1.36-.861-2.26-.982c-.878-.119-1.998-.117-3.391-.117zm0-1.5c-1.393 0-2.513-.002-3.392.117c-.9.12-1.658.38-2.26.981L7.41 3.41c.277-.277.665-.457 1.4-.556c.754-.101 1.756-.103 3.191-.103zM5.25 16c0 1.393-.002 2.513.117 3.392c.12.9.38 1.658.981 2.26L7.41 20.59c-.277-.277-.457-.665-.556-1.4c-.101-.755-.103-1.756-.103-3.191zM12 21.25c-1.435 0-2.437-.002-3.192-.103c-.734-.099-1.122-.28-1.399-.556l-1.06 1.06c.601.603 1.36.861 2.26.983c.878.118 1.998.116 3.391.116zm6.732-15.273c-.046-1.542-.208-2.757-1.08-3.629L16.59 3.41c.41.41.595 1.049.642 2.614zm-11.965.046c.047-1.565.231-2.203.642-2.614l-1.06-1.06c-.873.871-1.035 2.086-1.081 3.628zM18.75 16v-2h-1.5v2zm-12 0v-2h-1.5v2z"/><circle cx="17" cy="10" r="1" fill="currentColor"/>
          <path stroke="currentColor" stroke-linecap="round" stroke-width="1.5" d="M15 16.5H9m4 2.5H9"/>
        </g>
      </svg>
      <span>Imprimer le re√ßu</span>
    </button>
  </div>
<!--  END BODY -->
</div>
} @else {
  <div class="min-w-[450px] p-8 text-center text-gray-500">
    Aucune collecte s√©lectionn√©e
  </div>
}

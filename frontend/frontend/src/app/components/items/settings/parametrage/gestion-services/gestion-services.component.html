<div class="gestion-services">
  <!-- En-tête -->
  <div class="flex justify-between items-center mb-6">
    <div>
      <h3 class="text-xl font-bold text-gray-900">Gestion des services municipaux</h3>
      <p class="text-sm text-gray-600 mt-1">Gérez les services municipaux de la commune</p>
    </div>
    <div class="flex gap-3">
      <button (click)="loadDefaultData()" class="flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors">
        <svg class="size-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 6.25a.75.75 0 0 1 .75.75v4.75H17a.75.75 0 0 1 0 1.5h-4.25V18a.75.75 0 0 1-1.5 0v-4.75H7a.75.75 0 0 1 0-1.5h4.25V7a.75.75 0 0 1 .75-.75Z"/>
        </svg>
        Charger données par défaut
      </button>
      <button (click)="openCreateModal()" class="flex items-center gap-2 px-4 py-2 bg-main text-white rounded-lg hover:bg-main/90 transition-colors">
        <svg class="size-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 6.25a.75.75 0 0 1 .75.75v4.75H17a.75.75 0 0 1 0 1.5h-4.25V18a.75.75 0 0 1-1.5 0v-4.75H7a.75.75 0 0 1 0-1.5h4.25V7a.75.75 0 0 1 .75-.75Z"/>
        </svg>
        Nouveau service
      </button>
    </div>
  </div>

  <!-- Barre de recherche -->
  <div class="mb-6 flex gap-4">
    <input
      type="text"
      [(ngModel)]="searchTerm"
      (keyup.enter)="onSearch()"
      placeholder="Rechercher un service municipal..."
      class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-main"
    />
    <button (click)="onSearch()" class="px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">
      Rechercher
    </button>
  </div>

  <!-- Modal de création/édition -->
  <app-modal [(active)]="activeModal" [title]="isEditMode ? 'Modifier le service' : 'Nouveau service municipal'">
    <div class="w-full max-w-full">
      <h2 class="text-2xl text-main font-medium">{{ isEditMode ? 'Modification du service municipal' : 'Ajout du service municipal' }}</h2>
      <p>Saisissez les informations pour {{ isEditMode ? 'modifier' : 'ajouter' }} un service municipal</p>
      <form (ngSubmit)="saveService()" class="w-full grid gap-3 mt-8">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label for="service-nom" class="block text-sm/6 font-medium text-gray-900">
              Nom du service <sup>*</sup>
            </label>
            <div class="mt-2">
              <input
                type="text"
                id="service-nom"
                name="service-nom"
                [(ngModel)]="serviceForm.nom"
                required
                class="block w-full rounded-lg px-3 py-3 bg-background text-base text-gray-900 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-main sm:text-sm/6"
                placeholder="Ex: Direction des Finances"
              />
            </div>
          </div>

          <div>
            <label for="service-code" class="block text-sm/6 font-medium text-gray-900">
              Code du service <sup>*</sup>
            </label>
            <div class="mt-2">
              <input
                type="text"
                id="service-code"
                name="service-code"
                [(ngModel)]="serviceForm.code"
                required
                class="block w-full rounded-lg px-3 py-3 bg-background text-base text-gray-900 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-main sm:text-sm/6"
                placeholder="Ex: DIR-FIN"
              />
            </div>
          </div>
        </div>

        <div>
          <label for="service-description" class="block text-sm/6 font-medium text-gray-900">
            Description
          </label>
          <div class="mt-2">
            <textarea
              id="service-description"
              name="service-description"
              [(ngModel)]="serviceForm.description"
              rows="2"
              class="block w-full rounded-lg px-3 py-3 bg-background text-base text-gray-900 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-main sm:text-sm/6"
              placeholder="Description du service..."
            ></textarea>
          </div>
        </div>

        <div class="grid grid-cols-3 gap-4">
          <div>
            <label for="service-responsable" class="block text-sm/6 font-medium text-gray-900">
              Responsable
            </label>
            <div class="mt-2">
              <input
                type="text"
                id="service-responsable"
                name="service-responsable"
                [(ngModel)]="serviceForm.responsable"
                class="block w-full rounded-lg px-3 py-3 bg-background text-base text-gray-900 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-main sm:text-sm/6"
                placeholder="Nom du responsable"
              />
            </div>
          </div>

          <div>
            <label for="service-telephone" class="block text-sm/6 font-medium text-gray-900">
              Téléphone
            </label>
            <div class="mt-2">
              <input
                type="tel"
                id="service-telephone"
                name="service-telephone"
                [(ngModel)]="serviceForm.telephone"
                class="block w-full rounded-lg px-3 py-3 bg-background text-base text-gray-900 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-main sm:text-sm/6"
                placeholder="+241 XX XX XX XX"
              />
            </div>
          </div>

          <div>
            <label for="service-email" class="block text-sm/6 font-medium text-gray-900">
              Email
            </label>
            <div class="mt-2">
              <input
                type="email"
                id="service-email"
                name="service-email"
                [(ngModel)]="serviceForm.email"
                class="block w-full rounded-lg px-3 py-3 bg-background text-base text-gray-900 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-main sm:text-sm/6"
                placeholder="service@mairie.ga"
              />
            </div>
          </div>
        </div>

        <div class="flex items-center gap-2">
          <input
            type="checkbox"
            id="service-actif"
            name="service-actif"
            [(ngModel)]="serviceForm.actif"
            class="rounded border-gray-300 text-main focus:ring-main"
          />
          <label for="service-actif" class="text-sm/6 font-medium text-gray-900 cursor-pointer">Actif</label>
        </div>

        <div class="grid grid-cols-2 gap-3 mt-5">
          <button
            type="button"
            (click)="closeModal()"
            class="rounded-lg py-2 border-main border-2 text-main font-medium hover:bg-main/5 transition-colors"
          >
            Annuler
          </button>
          <button
            type="submit"
            class="rounded-lg py-2 bg-main text-white font-medium hover:bg-main/90 transition-colors"
          >
            {{ isEditMode ? 'Modifier' : 'Enregistrer' }}
          </button>
        </div>
      </form>
    </div>
  </app-modal>

  <!-- Liste des services -->
  @if (loading) {
    <div class="text-center py-8">
      <p class="text-gray-500">Chargement des services municipaux...</p>
    </div>
  } @else if (services.length === 0) {
    <div class="text-center py-8">
      <p class="text-gray-500">Aucun service municipal trouvé.</p>
    </div>
  } @else {
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      @for (service of services; track service.id) {
        <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm hover:shadow-md transition-shadow">
          <div class="flex justify-between items-start mb-3">
            <div>
              <h4 class="font-bold text-lg text-gray-900">{{ service.nom }}</h4>
              <p class="text-sm text-gray-500">{{ service.code }}</p>
            </div>
            <span [class]="'px-2 py-1 rounded text-xs font-semibold ' + (service.actif ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800')">
              {{ service.actif ? 'Actif' : 'Inactif' }}
            </span>
          </div>
          @if (service.description) {
            <p class="text-sm text-gray-600 mb-2">{{ service.description }}</p>
          }
          @if (service.responsable) {
            <p class="text-xs text-gray-500"><strong>Responsable:</strong> {{ service.responsable }}</p>
          }
          @if (service.telephone) {
            <p class="text-xs text-gray-500"><strong>Tél:</strong> {{ service.telephone }}</p>
          }
          @if (service.email) {
            <p class="text-xs text-gray-500"><strong>Email:</strong> {{ service.email }}</p>
          }
          <div class="flex gap-2 pt-3 mt-3 border-t">
            <button
              (click)="openEditModal(service)"
              class="flex-1 px-3 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 text-sm font-medium"
            >
              Modifier
            </button>
            <button
              (click)="toggleActif(service)"
              [class]="'flex-1 px-3 py-2 rounded-lg text-sm font-medium ' + (service.actif ? 'bg-yellow-50 text-yellow-700 hover:bg-yellow-100' : 'bg-green-50 text-green-700 hover:bg-green-100')"
            >
              {{ service.actif ? 'Désactiver' : 'Activer' }}
            </button>
            <button
              (click)="deleteService(service)"
              class="px-3 py-2 bg-red-50 text-red-700 rounded-lg hover:bg-red-100 text-sm font-medium"
            >
              Supprimer
            </button>
          </div>
        </div>
      }
    </div>
  }
</div>
